import{M as C}from"./classes-929a4aba.js";import{s as I}from"./requests-48cb46fe.js";import{d as w,l as b,i as y,O,p as j,q as S,s as p,P as R,o as s,c as _,w as k,b as l,t as D,v as M,x as h,n as d,F as $,y as x,z as L,u as v,A as T,S as P,B as V,a as N,T as A,D as q}from"./index-a9e6055c.js";import{_ as B}from"./IconButton.vue_vue_type_style_index_0_lang-60770588.js";import{_ as J}from"./Accordion.vue_vue_type_style_index_0_lang-c901b059.js";import{_ as z}from"./OrderListItem.vue_vue_type_script_setup_true_lang-8ae4ca92.js";const F={key:0,class:"badge text-bg-warning me-5"},K={key:1,class:"badge text-bg-info me-5"},Y={class:"list-group mx-3"},H={class:"my-2 mx-3 w-100"},U=d("b",null,"Total: ",-1),W=w({__name:"OngoingOrder",props:{order:null},setup(r){const e=r,n=b({timeDiff:new Date().getTime()-e.order.time.getTime(),intervalID:-1}),m=y(O);j(()=>{n.intervalID=setInterval(()=>{n.timeDiff=new Date().getTime()-e.order.time.getTime(),n.timeDiff>=60*60*1e3&&clearInterval(n.intervalID)},1*60*1e3)}),S(()=>{clearInterval(n.intervalID)});const f=p(()=>n.timeDiff>=60*60*1e3?"flashingred":n.timeDiff<=1*60*1e3?"flashing":""),u=y(R);async function a(){u.run(async()=>{if(e.order.phase=="cooking"&&m.remove(e.order),e.order.phase=C.parseStatus(e.order.toStatus()-1),!(await fetch(`${T}/orders/${e.order.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:e.order.toStatus()})})).ok)throw new Error(P)})}async function g(){const t=prompt("Apa alasan dari pembatalan pesanan ini?");u.run(async()=>{if(!(await fetch(`${T}/orders/${e.order.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:t})})).ok)throw new Error(P);m.remove(e.order)})}return(t,c)=>(s(),_(J,{class:L(v(f))},{header:k(()=>[r.order.phase=="pending"?(s(),l("span",F,"Pending")):D("",!0),r.order.phase=="cooking"?(s(),l("span",K,"Cooking")):D("",!0),M(" "+h(`${r.order.timeString} | Pesanan oleh ${r.order.username}`),1)]),default:k(()=>[d("ul",Y,[(s(!0),l($,null,x(r.order.orders,i=>(s(),_(z,{item:i},null,8,["item"]))),256))]),d("div",H,[U,M(" "+h(r.order.hargaTotal),1)]),r.order.phase=="pending"?(s(),l("button",{key:0,class:"mx-3 btn btn-warning",onClick:a},"Pesanan Sedang Dimasak")):D("",!0),r.order.phase=="cooking"?(s(),l("button",{key:1,class:"mx-3 btn btn-info",onClick:a},"Pesanan Selesai")):D("",!0),d("button",{class:"mx-3 btn btn-danger",onClick:g},"Batal Pesanan")]),_:1},8,["class"]))}});const Q={class:"list-group-item d-flex justify-content-between tss-bg-secondary my-1 sleek-shadow"},X={class:"text-start w-100"},Z=d("hr",null,null,-1),ee={class:"text-muted chef-mode-notes-list ms-4 p-0"},te={class:"tss-bg-primary rounded px-4 py-2"},ne={class:"fs-4"},se=w({__name:"ChefModeListItem",props:{item:null,earliest:null},setup(r){const e=r,n=b({intervalID:-1,timeDiff:new Date().getTime()-e.earliest.getTime()}),m=p(()=>e.item.note.split(`
`));p(()=>e.earliest.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1}));const f=p(()=>n.timeDiff<1*60*60*1e3?`${Math.ceil(n.timeDiff/(60*1e3))} menit yang lalu`:`${Math.ceil(n.timeDiff/(60*60*1e3))} jam yang lalu`);return j(()=>{n.intervalID=setInterval(()=>{n.timeDiff=new Date().getTime()-e.earliest.getTime()},60*1e3)}),S(()=>{clearInterval(n.intervalID)}),(u,a)=>(s(),l("li",Q,[d("div",X,[d("b",null,h(r.item.name),1),Z,d("ul",ee,[(s(!0),l($,null,x(v(m),g=>(s(),l("li",null,h(g),1))),256))])]),d("div",te,[d("div",ne,"x"+h(r.item.quantity),1),d("div",{class:L(["fs-6",{"text-danger":n.timeDiff>1*60*60*1e3}])},"Dari "+h(v(f)),3)])]))}});const re={class:"mx-3 mx-lg-5 mt-4"},ae={class:"mb-4 ms-2"},ie={key:0},oe={key:1},le=w({__name:"View",setup(r){const e=b({isChefMode:!1}),n=y(O),m=y(V);return I.on("newOrder",f=>{n.add(C.fromJSON(f))}),S(()=>{I.off("newOrder")}),(f,u)=>(s(),l("div",re,[d("div",ae,[e.isChefMode?(s(),_(B,{key:1,icon:"/storefront.svg",semantic:"Store Mode",class:"btn-primary",onClick:u[1]||(u[1]=a=>e.isChefMode=!1)})):(s(),_(B,{key:0,icon:"/restaurant.svg",semantic:"Chef Mode",class:"btn-primary",onClick:u[0]||(u[0]=a=>e.isChefMode=!0)}))]),e.isChefMode?(s(),l("div",ie,[N(A,{name:"list-slide-left",tag:"ul",class:"list-group"},{default:k(()=>[(s(!0),l($,null,x(v(m),a=>(s(),_(se,{item:a.order,earliest:a.earliest,key:a.order.id},null,8,["item","earliest"]))),128))]),_:1})])):(s(),l("div",oe,[N(A,{name:"list-slide-left"},{default:k(()=>[(s(!0),l($,null,x(v(n).data,a=>(s(),_(W,{order:a,key:a.id},null,8,["order"]))),128))]),_:1})]))]))}}),he=w({__name:"App",setup(r){const e=b({data:[],add:m,remove:f}),n=y(R);function m(t){e.data.push(t)}function f(t){const c=e.data.findIndex(i=>i.id==t.id);c!=-1&&e.data.splice(c,1)}function u(){n.run(async()=>{const t=await fetch(T+"/orders/chef",{credentials:"include"});if(!t.ok)throw t;const c=await t.json();e.data=C.fromJSONArray(c)})}function a(t){return new Date().getTime()-t.getDate()>1*60*60*1e3}const g=p(()=>{const t={};for(let i of e.data)for(let o of i.orders)t.hasOwnProperty(o.id)?(t[o.id].order.quantity+=o.quantity,t[o.id].order.note+=`
(oleh: ${i.username}) ${o.note}`,t[o.id].earliest=t[o.id].earliest.getTime()<=i.time.getTime()?t[o.id].earliest:i.time):(t[o.id]={order:o.copy(),earliest:i.time},t[o.id].order.note=`(oleh: ${i.username}) ${o.note}`);const c=[];for(let i in t)c.push(t[i]);return c.sort((i,o)=>{const E=a(i.earliest),G=a(o.earliest);return E==G?o.order.quantity-i.order.quantity:E?-1:1}),c});return u(),q(O,e),q(V,g),(t,c)=>(s(),_(le))}});export{he as default};
