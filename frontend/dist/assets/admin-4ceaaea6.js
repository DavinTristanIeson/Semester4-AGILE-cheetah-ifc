import{d as _,A as d,M as T,T as O,a as y,c as D,b as r,u as i,_ as k,e as A,F as R,o as b,R as I,f as o,w as g,n as E,S as C,C as N,r as v,g as m,h as P,i as V,j as M,k as $,l as h,m as q,p as x}from"./index-13c58849.js";const L=_("pageState",{state:()=>({isLoading:!1,isLoadingEphemeral:!1,errorMessage:"",timeoutID:-1}),actions:{cleanup(){this.setLoading(!1),this.clearError()},beginLoading(){this.isLoadingEphemeral=!0,this.isLoading=!0},setLoading(e){this.isLoading=e,this.isLoadingEphemeral=!1},cleanEphemeralLoading(){this.isLoadingEphemeral&&(this.isLoading=!1)},clearError(){clearTimeout(this.timeoutID),this.errorMessage="",this.cleanEphemeralLoading()},setError(e,t){this.errorMessage=e,clearTimeout(this.timeoutID),this.cleanEphemeralLoading(),t||(this.timeoutID=setTimeout(()=>{this.errorMessage=""},t))}}}),Z=_("ongoingOrders",{state:()=>({orders:[]}),getters:{chefMode(){const e={};for(let a of this.orders)for(let s of a.orders)e.hasOwnProperty(s.id)?(e[s.id].order.quantity+=s.quantity,e[s.id].order.note+=`
(oleh: ${a.username}) ${s.note}`,e[s.id].earliest=e[s.id].earliest.getTime()<=a.time.getTime()?e[s.id].earliest:a.time):(e[s.id]={order:s.copy(),earliest:a.time},e[s.id].order.note=`(oleh: ${a.username}) ${s.note}`);const t=[];for(let a in e)t.push(e[a]);function n(a){return new Date().getTime()-a.getDate()>1*60*60*1e3}return t.sort((a,s)=>{const c=n(a.earliest),f=n(s.earliest);return c==f?s.order.quantity-a.order.quantity:c?-1:1}),t}},actions:{async initialize(){const e=await fetch(d+"/orders/chef",{credentials:"include"});if(e.ok){const t=await e.json();this.orders=T.fromJSONArray(t)}},addOrder(e){this.orders.push(e)},removeOrder(e){const t=this.orders.indexOf(e);this.orders.splice(t,1)}}}),l=7,ee=_("transactions",{state:()=>({transactions:[],page:0,areTransactionsInitialized:!1}),getters:{current(e){return e.transactions.slice(e.page*l,e.page*l+l)},totalPages(e){return Math.floor(e.transactions.length/l)}},actions:{async initialize(){if(this.areTransactionsInitialized)return;const[e,t]=this.getDateRange(),n=await fetch(d+`/orders/transactions?start=${e.toISOString()}&end=${t.toISOString()}`,{credentials:"include"});if(n.ok){const a=await n.json(),s=T.fromJSONArray(a);this.transactions=O.summarize(s),this.areTransactionsInitialized=!0}},getDateRange(){const t=new Date(new Date().getTime()-6048e5*this.page);return[new Date(t.getTime()-6048e5),t]},changePage(e){this.page=e,this.getDateRange()},addNewTransaction(e){function t(a){return a.date.getDate()==e.time.getDate()&&a.date.getMonth()==e.time.getMonth()&&a.date.getFullYear()==e.time.getFullYear()}const n=this.transactions.find(t);n&&n.append(e)}}}),z=y({__name:"App",setup(e){const t=L();return(n,a)=>(b(),D(R,null,[r(k,{loading:i(t).isLoading},null,8,["loading"]),r(i(I)),r(A,{floating:!0,message:i(t).errorMessage,onClick:i(t).clearError},null,8,["message","onClick"])],64))}}),j={class:"navbar navbar-expand-lg fs-5"},Y={class:"container-fluid"},B=o("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},[o("span",{class:"navbar-toggler-icon"})],-1),F={class:"collapse navbar-collapse",id:"navbarSupportedContent"},H={class:"navbar-nav me-auto mb-2 mb-lg-0"},J={class:"nav-item"},G={class:"nav-item"},W=o("a",{href:"#",class:"nav-link"},"Logout",-1),K=[W],Q=y({__name:"Home",setup(e){const t=P(),n=V(),a=L();async function s(){try{(await fetch(d+"/accounts/logout",{method:"POST",credentials:"include"})).ok?n.replace({name:"login"}):a.setError(C,3e3)}catch{a.setError(N,3e3)}}return(c,f)=>{const u=v("RouterLink"),w=v("RouterView");return b(),D(R,null,[o("nav",j,[o("div",Y,[r(u,{class:"navbar-brand fs-2",to:"/admin/ongoing"},{default:g(()=>[m(" The Savory Spoon ")]),_:1}),B,o("div",F,[o("ul",H,[o("li",J,[r(u,{class:E(["nav-link",{active:i(t).name=="ongoing"}]),to:"/admin/ongoing"},{default:g(()=>[m("Pesanan Sekarang")]),_:1},8,["class"])]),o("li",G,[r(u,{class:E(["nav-link",{active:i(t).name=="transactions"}]),to:"/admin/transactions"},{default:g(()=>[m("Rangkuman Transaksi")]),_:1},8,["class"])]),o("li",{class:"nav-item",onClick:s},K)])])])]),r(w)],64)}}});async function S(){try{const e=await fetch(d+"/accounts/me",{credentials:"include"});return e.ok&&(await e.json()).isAdmin}catch(e){return console.error(e),!1}}const U=M({history:$("/"),routes:[{path:"/admin/login",name:"login",component:()=>h(()=>import("./App-9edf31c8.js"),["assets/App-9edf31c8.js","assets/StatefulForm.vue_vue_type_script_setup_true_lang-76d72d8b.js","assets/index-13c58849.js","assets/index-17f4caf7.css","assets/TextInput.vue_vue_type_script_setup_true_lang-bd015f1a.js","assets/CheckboxInput.vue_vue_type_script_setup_true_lang-518f203b.js","assets/inputs-6139d781.js","assets/App-7d294f9f.css"]),async beforeEnter(e,t,n){await S()?n({name:"index"}):n()}},{path:"/admin",name:"index",redirect:"/admin/ongoing",component:Q,async beforeEnter(e,t,n){await S()?n():n({name:"login"})},children:[{path:"/admin/ongoing",name:"ongoing",component:()=>h(()=>import("./App-533b8273.js"),["assets/App-533b8273.js","assets/index-13c58849.js","assets/index-17f4caf7.css","assets/Accordion.vue_vue_type_style_index_0_lang-8ee2a69f.js","assets/Accordion-4326cff9.css","assets/OrderListItem.vue_vue_type_script_setup_true_lang-f2209271.js","assets/IconButton.vue_vue_type_style_index_0_lang-b0d09b56.js","assets/IconButton-e46a7ea5.css","assets/requests-89d0a4b8.js","assets/App-713993d0.css"])},{path:"/admin/transactions",name:"transactions",component:()=>h(()=>import("./App-0e3b8206.js"),["assets/App-0e3b8206.js","assets/requests-89d0a4b8.js","assets/index-13c58849.js","assets/index-17f4caf7.css","assets/OrderListItem.vue_vue_type_script_setup_true_lang-f2209271.js","assets/App-ce67f730.css"])}]}]}),p=q(z);p.use(U);p.use(x());p.mount("#app");export{ee as a,L as b,Z as u};
