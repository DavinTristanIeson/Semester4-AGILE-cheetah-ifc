import{a as k,t as D,x as I,y as x,z as _,o as s,v as u,w as h,c as a,B as g,g as b,D as m,f as o,E as p,F as v,n as w,u as f,M as O,A as R,S as L,C as M,b as C,G as $}from"./index-13c58849.js";import{_ as B}from"./Accordion.vue_vue_type_style_index_0_lang-8ee2a69f.js";import{_ as V}from"./OrderListItem.vue_vue_type_script_setup_true_lang-f2209271.js";import{u as E,a as j,b as N}from"./admin-4ceaaea6.js";import{_ as S}from"./IconButton.vue_vue_type_style_index_0_lang-b0d09b56.js";import{I as z,s as T}from"./requests-89d0a4b8.js";const A={key:0,class:"badge text-bg-warning me-5"},F={key:1,class:"badge text-bg-info me-5"},G={class:"list-group mx-3"},J={class:"my-2 mx-3 w-100"},U=o("b",null,"Total: ",-1),q=k({__name:"OngoingOrder",props:{order:null},setup(n){const t=n,e=D({timeDiff:new Date().getTime()-t.order.time.getTime(),intervalID:-1}),i=E(),d=j();I(()=>{e.intervalID=setInterval(()=>{e.timeDiff=new Date().getTime()-t.order.time.getTime(),e.timeDiff>=60*60*1e3&&clearInterval(e.intervalID)},1*60*1e3)}),x(()=>{clearInterval(e.intervalID)});const c=_(()=>e.timeDiff>=60*60*1e3?"flashingred":e.timeDiff<=1*60*1e3?"flashing":""),l=N();async function r(){try{t.order.phase=="cooking"&&(i.removeOrder(t.order),d.addNewTransaction(t.order)),t.order.phase=O.parseStatus(t.order.toStatus()-1),(await fetch(`${R}/orders/${t.order.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:t.order.toStatus()})})).ok||l.setError(L,3e3)}catch(y){console.error(y),l.setError(M,3e3)}}return(y,re)=>(s(),u(B,{class:w(f(c))},{header:h(()=>[n.order.phase=="pending"?(s(),a("span",A,"Pending")):g("",!0),n.order.phase=="cooking"?(s(),a("span",F,"Cooking")):g("",!0),b(" "+m(`${n.order.timeString} | Pesanan oleh ${n.order.username}`),1)]),default:h(()=>[o("ul",G,[(s(!0),a(v,null,p(n.order.orders,P=>(s(),u(V,{item:P},null,8,["item"]))),256))]),o("div",J,[U,b(" "+m(n.order.hargaTotal),1)]),n.order.phase=="pending"?(s(),a("button",{key:0,class:"mx-3 btn btn-warning",onClick:r},"Pesanan Sedang Dimasak")):g("",!0),n.order.phase=="cooking"?(s(),a("button",{key:1,class:"mx-3 btn btn-info",onClick:r},"Pesanan Selesai")):g("",!0)]),_:1},8,["class"]))}});const W={class:"list-group-item d-flex justify-content-between tss-bg-secondary my-1 sleek-shadow"},H={class:"text-start w-100"},K=o("hr",null,null,-1),Q={class:"text-muted chef-mode-notes-list ms-4 p-0"},X={class:"tss-bg-primary rounded px-4 py-2"},Y={class:"fs-4"},Z=k({__name:"ChefModeListItem",props:{item:null,earliest:null},setup(n){const t=n,e=D({intervalID:-1,timeDiff:new Date().getTime()-t.earliest.getTime()}),i=_(()=>t.item.note.split(`
`));_(()=>t.earliest.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1}));const d=_(()=>e.timeDiff<1*60*60*1e3?`${Math.ceil(e.timeDiff/(60*1e3))} menit yang lalu`:`${Math.ceil(e.timeDiff/(60*60*1e3))} jam yang lalu`);return I(()=>{e.intervalID=setInterval(()=>{e.timeDiff=new Date().getTime()-t.earliest.getTime()},60*1e3)}),x(()=>{clearInterval(e.intervalID)}),(c,l)=>(s(),a("li",W,[o("div",H,[o("b",null,m(n.item.name),1),K,o("ul",Q,[(s(!0),a(v,null,p(f(i),r=>(s(),a("li",null,m(r),1))),256))])]),o("div",X,[o("div",Y,"x"+m(n.item.quantity),1),o("div",{class:w(["fs-6",{"text-danger":e.timeDiff>1*60*60*1e3}])},"Dari "+m(f(d)),3)])]))}});const ee={class:"mx-3 mx-lg-5 mt-4"},te={class:"mb-4 ms-2"},se={key:0},ne={key:1},ue=k({__name:"App",setup(n){const t=E(),e=N(),i=D({isChefMode:!1});e.setLoading(!0);const d=new z(t.initialize).on("success",()=>{e.setLoading(!1)}).on("failure",c=>{console.error(c),e.setLoading(!1),e.setError(M)});return d.run(),T.on("newOrder",c=>{t.addOrder(O.fromJSON(c))}),x(()=>{T.off("newOrder"),d.cleanup()}),(c,l)=>(s(),a("div",ee,[o("div",te,[i.isChefMode?(s(),u(S,{key:1,icon:"/storefront.svg",semantic:"Store Mode",class:"btn-primary",onClick:l[1]||(l[1]=r=>i.isChefMode=!1)})):(s(),u(S,{key:0,icon:"/restaurant.svg",semantic:"Chef Mode",class:"btn-primary",onClick:l[0]||(l[0]=r=>i.isChefMode=!0)}))]),i.isChefMode?(s(),a("div",se,[C($,{name:"list-slide-left",tag:"ul",class:"list-group"},{default:h(()=>[(s(!0),a(v,null,p(f(t).chefMode,r=>(s(),u(Z,{item:r.order,earliest:r.earliest,key:r.order.id},null,8,["item","earliest"]))),128))]),_:1})])):(s(),a("div",ne,[C($,{name:"list-slide-left"},{default:h(()=>[(s(!0),a(v,null,p(f(t).orders,r=>(s(),u(q,{order:r,key:r.id},null,8,["order"]))),128))]),_:1})]))]))}});export{ue as default};
